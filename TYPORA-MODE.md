# ✨ Typora 模式 - 编辑器内实时渲染

> 像 Typora 一样，在 Neovim 内直接看到渲染效果！

---

## 🎯 快速开始（3 步）

### 第一步：安装插件

```bash
cd ~/nvim-config
git pull origin claude/fix-python-nvim-cpu-usage-011CUrFUWgDFSZWhyJdLGGrL

# 重启 nvim
pkill -9 nvim
nvim
```

在 nvim 中运行：
```vim
:Lazy sync
```

等待 `render-markdown.nvim` 安装完成。

### 第二步：打开 Markdown 文件

```bash
nvim ~/test.md
```

### 第三步：启用 Typora 模式

按快捷键：
```
<Space>mr
```

**也就是：空格 + m + r**

---

## 🎨 效果演示

### 原始 Markdown（普通模式）

```markdown
# 我的文档

这是**重要内容**，还有*斜体*。

## 列表

- 第一项
- 第二项
  - 嵌套项

## 任务清单

- [ ] 待办事项
- [x] 已完成

## 代码

```python
def hello():
    print("World")
```

## 表格

| 姓名 | 年龄 |
|------|------|
| 张三 | 25   |
```

### 启用 Typora 模式后（按 `<Space>mr`）

你会看到：

```
󰲡  我的文档

这是重要内容，还有斜体。

󰲣  列表

● 第一项
● 第二项
  ○ 嵌套项

󰲣  任务清单

󰄱  待办事项
󰱒  已完成

󰲣  代码

  def hello():
      print("World")

󰲣  表格

┌────────┬────────┐
│  姓名  │  年龄  │
├────────┼────────┤
│  张三  │   25   │
└────────┴────────┘
```

- ✅ **加粗** 自动渲染
- ✅ *斜体* 自动渲染
- ✅ 标题显示图标和背景色
- ✅ 列表使用漂亮的符号
- ✅ Checkbox 显示图标
- ✅ 代码块有背景色
- ✅ 表格自动美化

---

## ⚡ 两种预览模式对比

### 1️⃣ Typora 模式（编辑器内）

**启用**: `<Space>mr`

**优点**：
- ✅ 不需要切换窗口
- ✅ 编辑的同时看到效果
- ✅ 专注写作
- ✅ 零延迟

**缺点**：
- ❌ 不支持 Mermaid 图表
- ❌ 数学公式渲染有限
- ❌ 受终端限制

**最适合**：
- 写笔记
- 写文档
- 快速编辑

### 2️⃣ 浏览器预览

**启用**: `<Space>mp`

**优点**：
- ✅ 完整的 HTML 渲染
- ✅ 支持 Mermaid 图表
- ✅ 完美的数学公式
- ✅ 自动滚动同步

**缺点**：
- ❌ 需要切换到浏览器
- ❌ 占用额外窗口

**最适合**：
- 写博客
- 复杂文档
- 需要图表和公式

---

## 🎯 推荐工作流

### 方案 1：纯 Typora 模式（推荐新手）

```
1. nvim document.md
2. 按 <Space>mr 启用渲染
3. 写作时实时看到效果
4. 保存 :w
```

### 方案 2：双预览模式（推荐高级用户）

```
1. nvim document.md
2. 按 <Space>mr 启用编辑器内渲染（写作时看）
3. 按 <Space>mp 启用浏览器预览（最终检查）
4. 左边 nvim 写，右边浏览器看最终效果
```

### 方案 3：切换模式

```
写作时：<Space>mr（Typora 模式，专注内容）
检查时：<Space>mr 关闭渲染，<Space>mp 浏览器预览
```

---

## 🎨 渲染特性

### ✨ 自动渲染的元素

- ✅ **标题** (H1-H6) - 带图标和背景色
- ✅ **加粗** (`**text**`) - 高亮显示
- ✅ **斜体** (`*text*`) - 斜体显示
- ✅ **代码** (`` `code` ``) - 背景色显示
- ✅ **代码块** - 背景色 + 语法高亮
- ✅ **列表** - 美化的项目符号
- ✅ **Checkbox** - 图标显示
- ✅ **表格** - 美化边框
- ✅ **引用块** - 左侧竖线
- ✅ **链接** - 图标显示
- ✅ **分隔线** - 美化显示

### 🎯 智能行为

1. **光标所在行不渲染**
   - 光标移到某行时，显示原始 Markdown
   - 方便编辑

2. **仅在普通模式渲染**
   - 按 `i` 进入插入模式时，显示原始内容
   - 按 `Esc` 回到普通模式时，自动渲染

3. **大文件保护**
   - 超过 1.5MB 的文件自动禁用渲染
   - 保证性能

---

## ⚡ 快捷键

### 渲染控制

| 快捷键 | 功能 |
|--------|------|
| `<Space>mr` | 切换 Typora 模式（开/关） |
| `<Space>mp` | 打开浏览器预览 |
| `<Space>ms` | 关闭浏览器预览 |

### 使用技巧

```
写作时：开启 <Space>mr（Typora 模式）
编辑时：光标移到行上自动显示原始内容
查看时：光标移开自动渲染
```

---

## 🎯 实战示例

### 示例 1：写笔记

```bash
nvim notes.md
```

在 nvim 中：
```
1. 按 <Space>mr 启用渲染
2. 按 i 进入插入模式
3. 输入：
   # 学习笔记

   今天学习了**Markdown 渲染**

   - 要点1
   - 要点2

4. 按 Esc 看渲染效果
5. 继续编辑...
```

### 示例 2：写文档

```markdown
1. nvim README.md
2. 按 <Space>mr 启用 Typora 模式
3. 写内容，实时看到美化效果
4. 按 <Space>mp 在浏览器检查最终效果
5. :w 保存
```

### 示例 3：快速记录

```markdown
1. nvim todo.md
2. 按 <Space>mr
3. 快速输入任务清单：
   - [ ] 任务1
   - [ ] 任务2
   - [x] 已完成
4. 看到漂亮的 checkbox 图标！
```

---

## 🎨 自定义配置

### 如果你想禁用某些渲染

编辑 `lua/plugins/init.lua`，找到 `render-markdown.nvim` 部分：

```lua
-- 禁用标题渲染
heading = {
  enabled = false,  -- 改成 false
},

-- 禁用代码块渲染
code = {
  enabled = false,
},

-- 禁用表格渲染
pipe_table = {
  enabled = false,
},
```

### 修改标题图标

```lua
heading = {
  icons = { "# ", "## ", "### ", "#### ", "#####", "######" },
},
```

### 修改项目符号

```lua
bullet = {
  icons = { "•", "◦", "▪", "▫" },
},
```

---

## ❓ 常见问题

### Q1: 按 `<Space>mr` 没反应？

**A:**
1. 确保在普通模式（按 `Esc`）
2. 确保在 Markdown 文件中（`:set filetype?` 应该是 `markdown`）
3. 确保插件已安装（`:Lazy`）

### Q2: 渲染效果看不清？

**A:**
1. 可能是配色主题的问题
2. 试试切换主题
3. 或者调整终端的透明度

### Q3: 光标行没有显示原始内容？

**A:**
这是正常的，配置中 `concealcursor = ""` 已经启用了这个功能。
如果不生效，检查 `:set conceallevel` 应该是 3。

### Q4: 某些元素没有渲染？

**A:**
检查 Treesitter 是否安装了 Markdown parser：
```vim
:TSInstall markdown markdown_inline
```

### Q5: 性能问题？

**A:**
1. 大文件（>1.5MB）会自动禁用
2. 可以调整 `max_file_size`
3. 或者只在需要时启用：`<Space>mr`

---

## 🎉 对比：Typora vs Neovim

| 功能 | Typora | Neovim (Typora 模式) |
|------|--------|----------------------|
| 实时渲染 | ✅ | ✅ |
| 所见即所得 | ✅ | ✅ (大部分) |
| 代码高亮 | ✅ | ✅ |
| 表格美化 | ✅ | ✅ |
| Mermaid | ✅ | ❌ (用浏览器预览) |
| 数学公式 | ✅ | ❌ (用浏览器预览) |
| Vim 键位 | ❌ | ✅ |
| 完全免费 | ❌ | ✅ |
| 轻量级 | ❌ | ✅ |
| 终端使用 | ❌ | ✅ |

---

## 🚀 推荐使用场景

### ✅ 适合用 Typora 模式：

- 写笔记
- 写文档草稿
- 快速记录
- 日常编辑
- 专注写作

### ⚠️ 建议用浏览器预览：

- 写博客（需要图表）
- 技术文档（有数学公式）
- 最终审阅
- 需要导出 HTML

---

## 💡 最佳实践

### 推荐配置

```
日常写作：Typora 模式（<Space>mr）
最终检查：浏览器预览（<Space>mp）
```

### 工作流

```
1. 开始写作
   → 启用 Typora 模式
   → 专注内容，实时看效果

2. 完善内容
   → 继续用 Typora 模式
   → 快速迭代

3. 最终审阅
   → 关闭 Typora 模式
   → 打开浏览器预览
   → 检查图表、公式、最终排版

4. 发布
   → 保存文件
```

---

## 📚 更多资源

- **插件仓库**: [render-markdown.nvim](https://github.com/MeanderingProgrammer/render-markdown.nvim)
- **完整教程**: [MARKDOWN-GUIDE.md](./MARKDOWN-GUIDE.md)
- **快速上手**: [MARKDOWN-QUICKSTART.md](./MARKDOWN-QUICKSTART.md)
- **快捷键表**: [CHEATSHEET.md](./CHEATSHEET.md)

---

## 🎉 总结

现在你有**两种预览方式**：

1. **Typora 模式** (`<Space>mr`)
   - 编辑器内实时渲染
   - 像 Typora 一样
   - 专注写作

2. **浏览器预览** (`<Space>mp`)
   - 完整的 HTML 渲染
   - 支持图表和公式
   - 最终审阅

**建议**：
- 写作时用 Typora 模式
- 检查时用浏览器预览
- 两者结合，完美体验！✨

开始享受 Typora 级别的编辑体验吧！🎉
